<!-- python3 -m http.server -->
<!DOCTYPE html>
<html>
<head> 
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <title>موقع عبدالعزيز</title>
    <style>
        /* Your CSS styles go here */
        @font-face {
            font-family: naskh;
            src: url(sources/UthmanTN.ttf);
        }
        @font-face {
            font-family: naskhBold;
            src: url(sources/UthmanTNB.ttf);
        }
        @font-face {
            font-family: Symbols1;
            src: url(sources/Symbols1.otf);
        }
        /* 
        source :https://fonts.qurancomplex.gov.sa/wp02/%d8%a7%d9%84%d9%85%d8%af%d8%b1%d8%ac%d8%a7%d8%aa/
        */

        h1 {
            text-align: center;
            font-family: Mysymbols;
        }
        h1, #askMe {
            text-align: center;
        }

        #askMe {
            display: block;
            margin: 0 auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        #askMe:hover {
            background-color: #45a049;
        }

        .basmlahp{
        color: black;
        text-align: center;
        margin: 30px 25px 30px 25px;
        font-family: Symbols1 ;
        font-size : 50px;
        font-weight: 1000;
        }

        .Ayahp{
        color: black;
        text-align: center;
        margin: 30px 25px 30px 25px;
        font-family: naskh;
        font-size : 25px;
        font-weight: 1000;

        }

        .answerbutton {
            display:inline-block; ;
            padding: 10px;
            width: 34%;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            background-color: blue;
            color: white;
            font-size: 16px;
            align-items: center;
            margin-top: 10px;
            margin-left: 30px;
            margin-bottom: 10px;

    }
        .answerbutton:hover {
            background-color: rgb(50, 50, 255);
        }
        

        #AyahContainer {
            background-color: rgb(243, 10, 84);
            justify-content: center;
            margin-top: 10px;

        }

        #answerContainer {
            background-color: rgb(35, 87, 161);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: -22px;
        }

        #bar-container {
            display: flex;
            margin-top : 30px;
            width: 100%;
            background-color: #080101;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            align-items: center;
            /* justify-content: center; */
        }

        #bar {
            background-color: #45a049;
            height: 65%;
            width : 0%;
            margin: 5px;
            border-radius: 12px;
        }

        @media only screen
        and (min-width: 550px) { 
        /* For disktops with screen size 550px or more */
            .Ayahp  {
                font-size: 40px;
            }
            .basmlahp {
                font-size: 75px;
            }
            
        }


        
    </style>
</head>
<body>
    <!-- Put your HTML code here -->
    <h1>  اعرف السورة من الآية</h1>
    <div id="askmeContiner">
        <select name="SelectLevel" id="SelectLevel" > 
            <option value="0" >جزء عم</option>
            <option value="1" >العشر الأخير</option>
            <option value="2" >الخمس الأخير</option>
            <option value="3" >الثلث الأخير</option>
            <option value="4" >النصف الأخير</option>
            <option value="5" >القرآن كاملا</option>
    
    
        </select>
        <select name="SelectOptions" id="SelectOptions">
            <option value="3">ثلاث خيارات</option>
            <option value="4">أربع خيارات</option>
            <option value="5">خمس خيارات</option>
            <option value="6">ست خيارات</option>
    
        </select>
        <button id="askMe" onclick="askmepleae()">أعطني آيه</button>
    

    </div>

    <div id="AyahContainer">





    </div>

    <div id="answerContainer">


    </div>

    <div id="bar-container">
        <div id="bar">
            
        </div>
    </div>
    <script>
        // Your JavaScript code goes here

        var Rangebox = document.getElementById("SelectLevel");
        var numberOfOptionsbox = document.getElementById("SelectOptions");
        var numberOfOptions = 4;
        var barSpeed = 7;
        const askmebutton = document.getElementById("askMe");
        const barContainer = document.getElementById("bar-container");
        const answerbutton = document.querySelectorAll('.answerbutton');
        const askmeContiner = document.getElementById("askmeContiner");
        var UserGotItRight = false;
        barContainer.style.display = 'none';

        // testing the bar
        var barDiv = document.getElementById("bar");
        barDiv.style.width = '0%';
        var i = 0; 
        function bar() {         //  create a loop function
            setTimeout(function() {   //  call a 3s setTimeout when the loop is called
              barDiv.style.width = (i/ barSpeed * 1.55) + '%';
              i++;                    //  increment the counter

 
            if (i < (66 * barSpeed)) {           //  if the counter < 10, call the loop function
            bar();             //  ..  again which will trigger another 
            }                      //  ..  setTimeout()
            else {
                console.log('done');
                i = 0;
                barDiv.style.width = '0%';
                askmebutton.disabled = false;
                if (UserGotItRight) {
                    askmepleae();
                    UserGotItRight = false;
                } else {
                    alert('لقد انتهى الوقت');
                    askmeContiner.style.display = 'block';
                    const answerbutton = document.querySelectorAll('.answerbutton');
                    answerbutton.forEach(element => {
                        element.disabled = true;
                    });
                }

            }
        }, 1)
       
        }

        
        
        function UpdateRange() {
        var range = Rangebox.value;
        
        switch (range) {
            case "0":
                min = 78;
                break;
            case "1":
                min = 58;
                break;
            case "2":
                min = 42;
                break;
            case "3":
                min = 29;
                break;
            case "4":
                min = 19;
                break;
            case "5":
                min = 1;
                break;
            default:
                min = 1;
                break;
        }
        }
        function updateNumberOfOptions() {
            var numberOfOptions = numberOfOptionsbox.value;
            console.log('numberOfOptions', numberOfOptions);
            return numberOfOptions;
        }
        max = 114;
        function askmepleae() {
            askmeContiner.style.display = 'none';
            askmebutton.disabled = true;
            barSpeed = 8;
            bar();
            UpdateRange();
            numberOfOptions = updateNumberOfOptions();
            console.log('min', min);
            console.log('max', max);
            fetch('https://abdulaziz0.sa/en.json')
                .then(response => response.json())
                .then(data => {
                    // Process the JSON response here
                    console.log(data);
                    randomSurah =  randomNumber(min, max);
                    rightanswernumber = randomSurah;

                    numberOfAyahs = data.data.surahs[randomSurah].ayahs.length;
                    randomayah = randomNumber(1, numberOfAyahs - 1);

                    console.log('randomSurah', randomSurah , 'numberOfAyahs', numberOfAyahs, 'randomayah', randomayah);

                    ayah = data.data.surahs[randomSurah].ayahs[randomayah].text;
                    if (ayah.includes("بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ")) {
                        ayah = ayah.replace("بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ ", "");
                    }

                const AyahContainer = document.querySelector('#AyahContainer');
                const basmlah = document.createElement('p');
                basmlah.textContent = '!' ; // "بِسْمِ اللَّهِ الرَّحْمَٰنِ الرَّحِيمِ"
                const Ayahp = document.createElement('p');
                Ayahp.textContent = "﴾ " + ayah + " ﴿";
                AyahContainer.innerHTML = '';
                AyahContainer.appendChild(basmlah);
                AyahContainer.appendChild(Ayahp); 
                basmlah.classList.add('basmlahp');   
                Ayahp.classList.add('Ayahp');


                rightanswer = data.data.surahs[randomSurah].name;
                numberOFwrongeAnswers = numberOfOptions - 1;
                wronganswers = []; // Initialize the wronganswers array
                for (i = 0 ; i < numberOFwrongeAnswers; i++) {
                    minWrong = rightanswernumber - 8 < min ? min : rightanswernumber - randomNumber(3 , 8);
                    maxWrong = rightanswernumber + 8 > max ? max : rightanswernumber + randomNumber(3 , 8);
                    console.log('minWrong', minWrong, 'maxWrong', maxWrong);
                    
                    randomSurah = randomNumber(minWrong, maxWrong);


                    if (data.data.surahs[randomSurah].ayahs.length == numberOfAyahs && data.data.surahs[randomSurah].ayahs[randomayah].text.includes(ayah) ){ // make sure there is no two right answers
                            --i;
                            continue; 
                            console.log('right answer duplecet skiped');
                                     
                    } 
                        if (wronganswers.includes(data.data.surahs[randomSurah].name)){ // to avoid duplicates wrong answers  
                            i --;
                            console.log('wrong answers duplecet skiped');
                            continue;   

                    }       
                         wronganswers[i] = data.data.surahs[randomSurah].name;
                            
        
                    
                    
                                                             }

                answers = [];
                answers[0] = rightanswer;
                const wrongeAnswers = numberOFwrongeAnswers; // Add missing variable declaration
                for (let i = 1; i < wrongeAnswers + 1; i++){ // Correct the loop condition
                    answers[i] = wronganswers[i-1]; 
                } 

               answers.sort(() => Math.random() - 0.5);
               const answerContainer = document.querySelector('#answerContainer');
                answerContainer.innerHTML = '';

                for (let i = 0; i < answers.length ; i++) {
                    let answer = document.createElement('button');
                    answer.textContent = answers[i];
                    answer.classList.add('answerbutton');
                    answer.onclick = function() {
                    checkanswer(answers[i], answer);
                    }
                    answerContainer.appendChild(answer);
                }
                barContainer.style.display = 'flex';


                })

                



                .catch(error => {
                    // Handle any errors here
                    console.error(error);
                });         


            }

            function checkanswer(answer , thisAnswer) {
                    if (answer == rightanswer) {
                        thisAnswer.style.backgroundColor = 'green';
                        alert("إجابة صحيحة بارك الله فيك");
                        UserGotItRight = true;
                        const answerbutton = document.querySelectorAll('.answerbutton');
                        answerbutton.forEach(element => {
                            element.disabled = true;
                        });
                        
                        } else {
                            thisAnswer.style.backgroundColor = 'red';
                            thisAnswer.disabled = true;

                        alert("إحابة خاطئة هداك الله. لا بأس حاول مرة أخرى");
                        userGotItRight = false;
                        }

                }
            
                /*
                code : 200
                status : "OK"
                data : {
                    surahs : [
                        0 : ....
                        1 : ....
                        114 : {
                            name : 'الناس'
                            ayahs : [
                                0 : {
                                    number : 1
                                    text : 'قل أعوذ برب الناس'
                                    numberInSurah : 1
                                    juz : 30
                                    manzil : 7
                                    page : 604
                                    ruku : 1
                                    hizbQuarter : 1
                                    sajda : false
                                }
                            ]


                        }


                    }


                }
                

                */
              
    function randomNumber(min, max) {  
        return Math.floor(Math.random() * (max - min + 1) + min - 1); 
    }    
       
    </script>
</body>
</html>
